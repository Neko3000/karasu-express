# Quickstart: Media Page Experience Optimization

**Feature**: 001-media-page-refinement
**Date**: 2026-02-05

## Prerequisites

- Node.js 18+ installed
- Project dependencies installed (`npm install`)
- MongoDB running locally or connection string configured
- PayloadCMS dev server running

## Quick Setup

### 1. Install Additional Dependencies

```bash
# Masonry grid layout (if not already installed)
npm install react-masonry-css
```

> **Note**: LightGallery is already part of the project per constitution.

### 2. Verify Existing Dependencies

Check `package.json` for:
```json
{
  "dependencies": {
    "lightgallery": "^2.x",
    "react-masonry-css": "^1.x"
  }
}
```

### 3. Start Development Server

```bash
npm run dev
```

### 4. Access Admin Panel

Navigate to: `http://localhost:3000/admin/collections/media`

---

## Development Guide

### File Structure

All new components go in `src/components/Media/`:

```
src/components/Media/
├── index.ts                    # Export barrel (update)
├── MediaThumbnailCell.tsx      # Existing - enhance
├── MediaThumbnailCell.module.css
├── MediaGalleryView.tsx        # NEW
├── MediaGalleryView.module.css # NEW
├── MediaListHeader.tsx         # NEW
├── MediaDetailView.tsx         # NEW
├── MediaDetailView.module.css  # NEW
├── ExpandableText.tsx          # NEW
├── FormattedJson.tsx           # NEW
├── RelativeTime.tsx            # NEW
└── MetadataBadge.tsx           # NEW
```

### Component Development Pattern

1. **Use `'use client'` directive** for all interactive components
2. **Wrap TailwindCSS in `.twp`** container
3. **Import LightGallery CSS** at component level
4. **Follow Constitution Principle VII** for heading/spacing standards

Example component structure:

```typescript
'use client';

import { useState } from 'react';

// LightGallery imports
import LightGallery from 'lightgallery/react';
import 'lightgallery/css/lightgallery.css';

// Styles
import styles from './MyComponent.module.css';

interface MyComponentProps {
  // ...
}

export function MyComponent({ ...props }: MyComponentProps) {
  return (
    <div className="twp">
      {/* TailwindCSS classes work here */}
    </div>
  );
}
```

### Testing During Development

```bash
# Run unit tests
npm test

# Run specific test file
npm test -- useViewPreference.test.ts

# Run tests in watch mode
npm test -- --watch
```

---

## Verification Checklist

### Gallery View (US1)

- [ ] View toggle button visible in Media list toolbar
- [ ] Clicking toggle switches between List and Gallery view
- [ ] Gallery displays images in masonry grid
- [ ] Clicking image opens LightGallery lightbox
- [ ] View preference persists after page refresh
- [ ] Responsive layout (test at 768px, 1024px, 1280px widths)

### Detail Page (US2)

- [ ] Image Preview section shows large image with zoom
- [ ] Basic Info section displays filename, dimensions, format, size, created
- [ ] Generation Info section shows SubTask link, model, style, prompts
- [ ] Generation Info hidden for non-generated media
- [ ] Actions section has Download and Copy Prompt buttons
- [ ] Copy Prompt shows success toast

### Hover Preview (US3)

- [ ] Hover shows enlarged preview with metadata
- [ ] Preview repositions near viewport edges
- [ ] Quick mouse movement doesn't flash preview
- [ ] Focus + Enter/Space triggers preview (keyboard)

### Metadata Controls (US4)

- [ ] Long prompts (>200 chars) collapse with Expand button
- [ ] Expand/Collapse toggle works
- [ ] JSON data shows formatted code block
- [ ] SubTask ID is clickable link
- [ ] Timestamps show relative time with full date on hover

---

## Common Issues

### LightGallery Not Opening

Ensure dynamic mode is enabled and elements are passed:

```typescript
<LightGallery
  dynamic
  dynamicEl={elements}
  // ...
/>
```

### TailwindCSS Classes Not Applied

Wrap in `.twp` container:

```typescript
<div className="twp">
  <div className="bg-gray-100 p-4">
    {/* Works */}
  </div>
</div>
```

### Hover Preview Position Wrong

Check viewport calculation in `MediaThumbnailCell.tsx`:
- Account for scroll position
- Use `getBoundingClientRect()` for accurate positioning

### localStorage Not Persisting

Check browser privacy mode and localStorage availability:

```typescript
const isLocalStorageAvailable = () => {
  try {
    localStorage.setItem('test', 'test');
    localStorage.removeItem('test');
    return true;
  } catch {
    return false;
  }
};
```

---

## Next Steps

1. Complete tasks in `tasks.md` (generated by `/speckit.tasks`)
2. Run tests after each component implementation
3. Review against Constitution Principle VII before PR
